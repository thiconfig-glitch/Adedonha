<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adedonha Security</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050014">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* --- VISUAL CYBERPUNK --- */
        :root { 
            --bg: #050014; 
            --thiago: #00f3ff; 
            --samella: #ff0055; 
            --roxo: #bd00ff; 
            --amarelo: #ffeb3b; 
            --ouro: #ffd700; 
            --vidro: rgba(255, 255, 255, 0.05); 
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(189, 0, 255, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 243, 255, 0.2) 0%, transparent 40%);
            color: #fff; font-family: 'Rajdhani', sans-serif; 
            min-height: 100vh; overflow-x: hidden; display: flex; flex-direction: column;
        }

        /* HEADER */
        header {
            display: flex; justify-content: space-between; align-items: center; padding: 15px 20px;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); 
            border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100;
        }
        .logo { font-family: 'Orbitron'; font-weight: 900; letter-spacing: 2px; background: linear-gradient(90deg, var(--thiago), var(--samella)); -webkit-background-clip: text; color: transparent; }
        .round-badge { border: 1px solid var(--amarelo); color: var(--amarelo); padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; font-family: 'Orbitron'; box-shadow: 0 0 10px rgba(255, 235, 59, 0.3); }
        
        /* PLACAR */
        #scoreboard {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; margin: 15px; background: var(--vidro); 
            border: 1px solid rgba(255,255,255,0.1); border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .score-box { text-align: center; width: 45%; }
        .s-name { font-size: 0.8rem; color: #aaa; letter-spacing: 2px; margin-bottom: 5px; }
        .s-val { font-family: 'Orbitron'; font-size: 2rem; font-weight: bold; text-shadow: 0 0 10px currentColor; }
        
        /* TELAS */
        .screen { display: none; padding: 20px; flex-direction: column; align-items: center; flex: 1; animation: fadeIn 0.4s ease; }
        .active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* TELA SENHA */
        .lock-icon { font-size: 4rem; margin-bottom: 20px; color: var(--roxo); text-shadow: 0 0 20px var(--roxo); }

        /* TELA SELE√á√ÉO */
        .p-card {
            width: 100%; max-width: 350px; height: 110px; margin-bottom: 20px;
            background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0));
            border: 1px solid #444; border-radius: 15px;
            display: flex; align-items: center; justify-content: space-between; padding: 25px; cursor: pointer;
            transition: 0.3s; position: relative; overflow: hidden;
        }
        .p-card::before { content:''; position: absolute; left: 0; top: 0; bottom: 0; width: 5px; }
        .card-t { border-color: var(--thiago); } .card-t::before { background: var(--thiago); box-shadow: 2px 0 15px var(--thiago); }
        .card-s { border-color: var(--samella); } .card-s::before { background: var(--samella); box-shadow: 2px 0 15px var(--samella); }
        .p-card:active { transform: scale(0.98); filter: brightness(1.2); }

        /* JOGO */
        .roleta {
            width: 140px; height: 140px; border-radius: 50%; border: 4px solid var(--roxo);
            display: flex; justify-content: center; align-items: center; margin: 20px 0;
            background: rgba(0,0,0,0.3); box-shadow: 0 0 40px rgba(189, 0, 255, 0.4);
        }
        #letra-big { font-family: 'Orbitron'; font-size: 5rem; text-shadow: 0 0 20px #fff; }

        .input-wrap { width: 100%; margin-bottom: 15px; position: relative; }
        .input-tag { position: absolute; top: -10px; left: 10px; background: #050014; padding: 0 8px; color: var(--roxo); font-size: 0.8rem; font-weight: bold; border: 1px solid #333; border-radius: 4px; }
        .game-input {
            width: 100%; background: transparent; border: 1px solid #444; border-radius: 10px;
            color: #fff; padding: 15px; font-size: 1.2rem; font-family: 'Rajdhani'; transition: 0.3s;
        }
        .game-input:focus { border-color: var(--thiago); outline: none; background: rgba(0, 243, 255, 0.05); box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }

        /* BOT√ïES */
        .btn { width: 100%; padding: 18px; border: none; border-radius: 12px; font-family: 'Orbitron'; font-size: 1.1rem; font-weight: bold; color: #fff; cursor: pointer; margin-bottom: 15px; transition: 0.2s; }
        .btn-girar { background: linear-gradient(45deg, #7b00ff, #bd00ff); box-shadow: 0 4px 15px rgba(123, 0, 255, 0.4); }
        .btn-stop { background: linear-gradient(45deg, #ff0055, #ff4d00); font-size: 1.5rem; animation: pulse 1.5s infinite; margin-top: 20px; box-shadow: 0 0 20px rgba(255, 0, 85, 0.4); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* RESULTADOS */
        .res-row { background: rgba(255,255,255,0.03); width: 100%; padding: 12px; margin-bottom: 8px; border-left: 4px solid #555; border-radius: 0 8px 8px 0; text-align: left; }
        .res-cat { font-size: 0.75rem; color: #888; text-transform: uppercase; margin-bottom: 2px; }
        .res-pts { float: right; font-family: 'Orbitron'; font-weight: bold; }

        /* MENU CONFIGURA√á√ïES */
        #modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:999; display:none; justify-content:center; align-items:center; flex-direction:column; backdrop-filter: blur(8px); }
        .modal-box { background:#151520; padding:25px; border-radius:20px; border:1px solid #333; text-align:center; width:85%; max-width: 320px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        .cfg-btn { 
            background: transparent; border: 1px solid #444; color: #888; 
            padding: 12px; margin: 6px 0; width: 100%; border-radius: 8px; 
            font-family: 'Orbitron'; cursor: pointer; transition: 0.3s;
        }
        .cfg-btn.active { border-color: var(--roxo); color: var(--roxo); background: rgba(189, 0, 255, 0.15); box-shadow: 0 0 15px rgba(189, 0, 255, 0.2); }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>
        <div class="logo">ADEDONHA</div>
        <div class="round-badge" id="hud-round">R: 1/10</div>
        <div onclick="toggleMenu()" style="font-size:1.5rem; cursor:pointer; color:#fff;">‚öôÔ∏è</div>
    </header>

    <div id="scoreboard" class="hidden">
        <div class="score-box">
            <div class="s-name">THIAGO</div>
            <div class="s-val" style="color:var(--thiago)" id="hud-thiago">0</div>
        </div>
        <div style="font-family:'Orbitron'; color:#555; font-size: 0.8rem;">VS</div>
        <div class="score-box">
            <div class="s-name">S√ÇMELLA</div>
            <div class="s-val" style="color:var(--samella)" id="hud-samella">0</div>
        </div>
    </div>

    <div id="screen-password" class="screen active" style="justify-content: center;">
        <div class="lock-icon">üîí</div>
        <h2 style="font-family:'Orbitron'; margin-bottom:20px;">ACESSO RESTRITO</h2>
        <div class="input-wrap">
            <input type="password" id="senha-input" class="game-input" placeholder="Digite a senha..." style="text-align:center;">
        </div>
        <button class="btn btn-girar" onclick="verificarSenha()">ENTRAR</button>
    </div>

    <div id="screen-login" class="screen">
        <h1 style="font-family:'Orbitron'; margin:30px 0; color:var(--roxo); text-shadow: 0 0 20px rgba(189,0,255,0.5);">BATTLE MODE</h1>
        <div class="p-card card-t" onclick="login('THIAGO')">
            <span style="font-size:2.5rem;">üë®üèª</span>
            <span style="font-family:'Orbitron'; font-size:1.4rem; color:var(--thiago);">THIAGO</span>
        </div>
        <div class="p-card card-s" onclick="login('SAMELLA')">
            <span style="font-size:2.5rem;">üë©üèª</span>
            <span style="font-family:'Orbitron'; font-size:1.4rem; color:var(--samella);">S√ÇMELLA</span>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="roleta"><span id="letra-big">?</span></div>
        <button class="btn btn-girar" onclick="girar()">GIRAR ROLETA</button>
        <div id="inputs-area" style="width:100%;"></div>
        <button class="btn btn-stop" onclick="darStop()">STOP!</button>
    </div>

    <div id="screen-result" class="screen">
        <h2 style="color:var(--amarelo); font-family:'Orbitron'; margin-bottom:20px;">FIM DE ROUND</h2>
        <div id="result-list" style="width:100%;"></div>
        <div style="margin: 20px 0; font-size:1.5rem;">
            TOTAL: <strong id="total-round" style="color:var(--amarelo)">0</strong>
        </div>
        <button class="btn btn-girar" id="btn-next" onclick="proximaRodada()">PR√ìXIMA >></button>
    </div>

    <div id="screen-victory" class="screen" style="justify-content:center;">
        <div style="font-size:6rem; animation: bounce 1s infinite alternate;">üèÜ</div>
        <h1 style="color:var(--ouro); margin-bottom:10px; text-shadow: 0 0 20px var(--ouro);">CAMPE√ÉO</h1>
        <h2 id="winner-name" style="font-family:'Orbitron'; font-size:3.5rem; margin-bottom:40px;">...</h2>
        <button class="btn btn-stop" onclick="zerarTudo()">NOVA PARTIDA</button>
    </div>

    <div id="modal">
        <div class="modal-box">
            <h3 style="color:#fff; margin-bottom:20px; font-family:'Orbitron'; border-bottom:1px solid #333; padding-bottom:10px;">CONFIGURA√á√ïES</h3>
            
            <p style="color:#666; font-size:0.8rem; margin-bottom:10px;">LIMITE DE RODADAS:</p>
            <button class="cfg-btn" id="cfg-5" onclick="setConfig(5)">R√ÅPIDO (5)</button>
            <button class="cfg-btn" id="cfg-10" onclick="setConfig(10)">PADR√ÉO (10)</button>
            <button class="cfg-btn" id="cfg-20" onclick="setConfig(20)">LONGO (20)</button>
            
            <div style="margin-top:20px; padding-top:15px; border-top:1px solid #333;">
                <button class="btn" style="background:rgba(255,0,0,0.1); border:1px solid red; color:red; padding:12px; font-size:0.9rem;" onclick="zerarTudo()">‚ö†Ô∏è ZERAR PLACAR</button>
                <button class="btn" style="background:#000; padding:12px; margin-top:5px;" onclick="toggleMenu()">VOLTAR</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyAjgEFZB3_FHelXH9YtCnFYFO4RCGO7Wd8",
            authDomain: "adedonha-8b2a4.firebaseapp.com",
            databaseURL: "https://adedonha-8b2a4-default-rtdb.firebaseio.com",
            projectId: "adedonha-8b2a4",
            storageBucket: "adedonha-8b2a4.firebasestorage.app",
            messagingSenderId: "1061633793316",
            appId: "1:1061633793316:web:e4f9a23ce9e28ae8d2e7b1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const ref = db.ref('partida_casal');

        // CACHE CLEAR
        if ('serviceWorker' in navigator) navigator.serviceWorker.getRegistrations().then(r => r.forEach(i => i.unregister()));

        // VARS
        let eu = "";
        let ele = "";
        let maxR = 10;
        let rodada = 1;
        let lastLetter = ""; 
        const cats = ["Nome", "Animal", "Cor", "Fruta", "Objeto", "CEP", "Profiss√£o", "Marca", "Corpo", "Sogra"];

        // L√ìGICA DE SENHA
        function verificarSenha() {
            const pass = document.getElementById('senha-input').value;
            if (pass === 'ceros') {
                document.getElementById('screen-password').classList.remove('active');
                document.getElementById('screen-login').classList.add('active');
            } else {
                alert('SENHA INCORRETA! Tente novamente.');
                document.getElementById('senha-input').value = "";
            }
        }

        // LOGIN
        function login(nome) {
            eu = nome;
            ele = (nome === 'THIAGO') ? 'SAMELLA' : 'THIAGO';
            document.getElementById('screen-login').classList.remove('active');
            document.getElementById('scoreboard').classList.remove('hidden');
            document.getElementById('screen-game').classList.add('active');
            
            const div = document.getElementById('inputs-area');
            div.innerHTML = "";
            cats.forEach(c => {
                div.innerHTML += `
                    <div class="input-wrap">
                        <span class="input-tag">${c}</span>
                        <input type="text" class="game-input" id="in-${c}" oninput="salvarLocal()" autocomplete="off">
                    </div>`;
            });
            ouvirBanco();
        }

        function salvarLocal() {
            let r = {};
            cats.forEach(c => r[c] = document.getElementById(`in-${c}`).value);
            ref.child('respostas').child(eu).update(r);
        }

        function ouvirBanco() {
            ref.on('value', snap => {
                const d = snap.val() || {};
                
                // HUD
                document.getElementById('hud-thiago').innerText = d.placar_thiago || 0;
                document.getElementById('hud-samella').innerText = d.placar_samella || 0;
                maxR = d.config_max || 10;
                rodada = d.rodada || 1;
                document.getElementById('hud-round').innerText = `R: ${rodada}/${maxR}`;
                
                // ATUALIZA VISUAL DO MENU (DESTAQUE NA OP√á√ÉO ATIVA)
                updateMenuHighlight(maxR);

                // LETRA
                if(d.letra) document.getElementById('letra-big').innerText = d.letra;

                // ESTADOS
                if (d.status === 'STOP') {
                    mostrarResultado(d.respostas);
                } 
                else if (d.status === 'JOGANDO') {
                    trocarTela('screen-game');
                    // Limpa inputs APENAS se mudou a rodada/letra
                    if (d.limpar_id && d.limpar_id !== lastLetter) {
                        lastLetter = d.limpar_id;
                        document.querySelectorAll('input').forEach(i => i.value = "");
                    }
                } 
                else if (d.status === 'VITORIA') {
                    trocarTela('screen-victory');
                    let pt = d.placar_thiago || 0;
                    let ps = d.placar_samella || 0;
                    let w = (pt > ps) ? "THIAGO" : (ps > pt) ? "S√ÇMELLA" : "EMPATE";
                    let c = (pt > ps) ? "var(--thiago)" : (ps > pt) ? "var(--samella)" : "#fff";
                    document.getElementById('winner-name').innerText = w;
                    document.getElementById('winner-name').style.color = c;
                }
            });
        }

        function girar() {
            if(rodada > maxR) { ref.update({status:'VITORIA'}); return; }
            const abc = "ABCDEFGHILMNOPQRSTUVZ";
            const l = abc[Math.floor(Math.random() * abc.length)];
            
            ref.update({
                status: 'JOGANDO',
                letra: l,
                respostas: {}, 
                limpar_id: Date.now() 
            });
        }

        function darStop() {
            salvarLocal();
            ref.update({ status: 'STOP', quem: eu });
        }

        function mostrarResultado(allResps) {
            trocarTela('screen-result');
            const lista = document.getElementById('result-list');
            lista.innerHTML = "";
            
            const meus = (allResps && allResps[eu]) ? allResps[eu] : {};
            const dele = (allResps && allResps[ele]) ? allResps[ele] : {};
            let total = 0;

            cats.forEach(c => {
                let m = (meus[c] || "").trim();
                let o = (dele[c] || "").trim();
                let mN = m.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                let oN = o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                let p = 0; let color = "#fff"; let border = "#333";
                if(mN === "") { p = 0; border="#f05"; color="#f05"; }
                else if(mN === oN) { p = 5; border="#fe0"; color="#fe0"; }
                else { p = 10; border="#0ff"; color="#0ff"; }
                
                total += p;
                
                lista.innerHTML += `
                    <div class="res-row" style="border-color:${border}">
                        <div class="res-cat">${c} <span class="res-pts" style="color:${color}">+${p}</span></div>
                        <div style="font-size:1.1rem;">${m || "-"}</div>
                        <div style="font-size:0.8rem; color:#666;">${ele}: ${o || "-"}</div>
                    </div>`;
            });
            
            document.getElementById('total-round').innerText = total;

            const btn = document.getElementById('btn-next');
            if(rodada >= maxR) {
                btn.innerText = "VER CAMPE√ÉO üèÜ";
                btn.style.background = "var(--ouro)";
                btn.style.color = "#000";
            } else {
                btn.innerText = "PR√ìXIMA RODADA >>";
                btn.style.background = "";
            }

            ref.once('value').then(s => {
                const d = s.val();
                if(d.quem === eu) {
                    let key = `placar_${eu.toLowerCase()}`;
                    let atual = d[key] || 0;
                    ref.child(key).set(atual + total);
                } else {
                     let key = `placar_${eu.toLowerCase()}`;
                     let atual = d[key] || 0;
                     ref.child(key).set(atual + total);
                }
            });
        }

        function proximaRodada() {
            if(rodada >= maxR) {
                ref.update({status:'VITORIA'});
            } else {
                ref.child('rodada').transaction(r => (r||1)+1);
                girar();
            }
        }

        function trocarTela(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function toggleMenu() {
            const m = document.getElementById('modal');
            m.style.display = (m.style.display == 'flex') ? 'none' : 'flex';
        }

        function setConfig(n) {
            ref.update({ config_max: n });
            toggleMenu();
        }
        
        function updateMenuHighlight(val) {
            document.querySelectorAll('.cfg-btn').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById(`cfg-${val}`);
            if(btn) btn.classList.add('active');
        }

        function zerarTudo() {
            if(confirm("ZERAR TUDO?")) {
                ref.update({
                    placar_thiago: 0, placar_samella: 0,
                    rodada: 1, status: 'JOGANDO', letra: '?',
                    respostas: {}
                });
                toggleMenu();
            }
        }
    </script>
</body>
</html>
