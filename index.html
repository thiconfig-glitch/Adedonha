<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adedonha (Versão Limpa)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { background: #050014; color: #fff; font-family: sans-serif; padding: 20px; text-align: center; }
        h1 { color: #bd00ff; margin-bottom: 5px; }
        .status { color: #00f3ff; font-size: 14px; margin-bottom: 20px; }
        
        .box { border: 2px solid #bd00ff; padding: 20px; margin: 20px 0; border-radius: 10px; background: rgba(255,255,255,0.05); }
        .letra-big { font-size: 80px; font-weight: bold; display: block; margin: 10px 0; }
        
        button { width: 100%; padding: 20px; font-size: 18px; border-radius: 10px; border: none; margin-bottom: 10px; cursor: pointer; color: #fff; font-weight: bold; }
        .btn-thiago { background: #007bff; }
        .btn-samella { background: #e83e8c; }
        .btn-girar { background: #bd00ff; }
        .btn-stop { background: #ff0055; animation: pulsar 1s infinite; }
        
        @keyframes pulsar { 0% {transform: scale(1);} 50% {transform: scale(1.02);} 100% {transform: scale(1);} }

        /* Lista de Respostas */
        #lista-respostas { text-align: left; margin-top: 20px; }
        .item { border-bottom: 1px solid #333; padding: 5px; display: flex; justify-content: space-between; }
        input { width: 100%; padding: 10px; margin-top: 5px; background: #222; border: 1px solid #444; color: white; font-size: 16px; }
    </style>
</head>
<body>

    <h1>ADEDONHA</h1>
    <div class="status" id="status-txt">Desconectado...</div>

    <div id="tela-login">
        <button class="btn-thiago" onclick="entrar('THIAGO')">SOU O THIAGO</button>
        <button class="btn-samella" onclick="entrar('SAMELLA')">SOU A SÂMELLA</button>
    </div>

    <div id="tela-jogo" style="display:none;">
        <p>Jogando como: <strong id="meu-nome">...</strong></p>
        
        <div class="box">
            <span class="letra-big" id="letra-display">?</span>
            <button class="btn-girar" onclick="girar()">GIRAR NOVO JOGO</button>
        </div>

        <div id="formulario"></div>

        <button class="btn-stop" onclick="darStop()">STOP! (PARAR TUDO)</button>
    </div>

    <div id="tela-resumo" style="display:none;">
        <h2 style="color: #ff0055">STOP ACIONADO!</h2>
        <p>Respostas do Oponente:</p>
        <div id="lista-respostas">Carregando...</div>
        <button class="btn-girar" onclick="reiniciar()">JOGAR NOVAMENTE</button>
    </div>

    <script>
        // --- 1. CONFIGURAÇÃO (SUAS CHAVES) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAjgEFZB3_FHelXH9YtCnFYFO4RCGO7Wd8",
            authDomain: "adedonha-8b2a4.firebaseapp.com",
            databaseURL: "https://adedonha-8b2a4-default-rtdb.firebaseio.com",
            projectId: "adedonha-8b2a4",
            storageBucket: "adedonha-8b2a4.firebasestorage.app",
            messagingSenderId: "1061633793316",
            appId: "1:1061633793316:web:e4f9a23ce9e28ae8d2e7b1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const ref = db.ref('partida_casal');

        // --- 2. FORÇA LIMPEZA DE CACHE ---
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(regs => {
                regs.forEach(reg => reg.unregister());
            });
        }

        // --- 3. LÓGICA ---
        let meuNome = "";
        let oponente = "";
        const categorias = ["Nome", "Animal", "Cor", "Fruta", "Objeto", "CEP", "Profissão", "Marca", "Corpo", "Sogra"];

        function entrar(nome) {
            meuNome = nome;
            oponente = (nome === 'THIAGO') ? 'SAMELLA' : 'THIAGO';
            document.getElementById('tela-login').style.display = 'none';
            document.getElementById('tela-jogo').style.display = 'block';
            document.getElementById('meu-nome').innerText = nome;
            gerarCampos();
            escutar();
        }

        function escutar() {
            ref.on('value', snapshot => {
                const dados = snapshot.val();
                document.getElementById('status-txt').innerText = "Conectado | Status: " + (dados?.status || "---");

                if (!dados) return;

                // ATUALIZA LETRA
                if (dados.letra) document.getElementById('letra-display').innerText = dados.letra;

                // ATUALIZA TELAS
                if (dados.status === 'STOP') {
                    salvarLocais(); // Garante salvar o que eu digitei
                    irParaResumo(dados.respostas);
                } else if (dados.status === 'JOGANDO') {
                    document.getElementById('tela-resumo').style.display = 'none';
                    document.getElementById('tela-jogo').style.display = 'block';
                }
            });
        }

        function girar() {
            const letras = "ABCDEFGHILMNOPQRSTUVZ";
            const l = letras[Math.floor(Math.random() * letras.length)];
            
            // Tenta escrever no banco. Se falhar, avisa na tela.
            ref.update({ status: 'JOGANDO', letra: l, respostas: {} })
               .catch(erro => alert("ERRO DE PERMISSÃO: Verifique as Regras no Firebase!\n" + erro.message));
        }

        function darStop() {
            salvarLocais();
            ref.update({ status: 'STOP', quem: meuNome })
               .catch(erro => alert("ERRO AO DAR STOP: O Firebase bloqueou a escrita."));
        }

        function salvarLocais() {
            const inputs = document.querySelectorAll('input');
            let resps = {};
            inputs.forEach(i => resps[i.id] = i.value);
            ref.child('respostas').child(meuNome).update(resps);
        }

        function gerarCampos() {
            const div = document.getElementById('formulario');
            div.innerHTML = "";
            categorias.forEach(c => {
                div.innerHTML += `<div style="text-align:left; color:#bd00ff; margin-top:10px;">${c}</div><input type="text" id="${c}" oninput="salvarLocais()">`;
            });
        }

        function irParaResumo(todasRespostas) {
            document.getElementById('tela-jogo').style.display = 'none';
            document.getElementById('tela-resumo').style.display = 'block';
            
            const div = document.getElementById('lista-respostas');
            div.innerHTML = "";
            
            if (todasRespostas && todasRespostas[oponente]) {
                const respsOponente = todasRespostas[oponente];
                categorias.forEach(c => {
                    div.innerHTML += `<div class="item"><span>${c}</span> <strong>${respsOponente[c] || '-'}</strong></div>`;
                });
            } else {
                div.innerHTML = "<p>O oponente não escreveu nada...</p>";
            }
        }
        
        function reiniciar() {
            ref.update({ status: 'JOGANDO', letra: '?' });
        }
    </script>
</body>
</html>
